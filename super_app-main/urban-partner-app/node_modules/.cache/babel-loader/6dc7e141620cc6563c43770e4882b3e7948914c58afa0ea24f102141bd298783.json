{"ast":null,"code":"const WS_URL=process.env.REACT_APP_WS_URL||'ws://localhost:5000';class WebSocketService{constructor(){this.socket=null;this.messageListeners=new Set();this.reconnectAttempts=0;this.maxReconnectAttempts=5;this.reconnectDelay=1000;// 1 second\n}connect(){let namespace=arguments.length>0&&arguments[0]!==undefined?arguments[0]:'/partner';let token=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;if(this.socket)return;const authToken=token||localStorage.getItem('partnerToken')||localStorage.getItem('token')||localStorage.getItem('authToken');if(!authToken){console.error('No authentication token found');return;}this.socket=new WebSocket(\"\".concat(WS_URL).concat(namespace,\"?token=\").concat(authToken));this.socket.onopen=()=>{console.log('WebSocket Connected');this.reconnectAttempts=0;};this.socket.onmessage=event=>{try{const data=JSON.parse(event.data);this.messageListeners.forEach(listener=>listener(data));}catch(error){console.error('Error parsing WebSocket message:',error);}};this.socket.onerror=error=>{console.error('WebSocket error:',error);};this.socket.onclose=()=>{console.log('WebSocket Disconnected');this.socket=null;this.attemptReconnect();};}disconnect(){if(this.socket){this.socket.close();this.socket=null;}}subscribe(callback){this.messageListeners.add(callback);return()=>this.messageListeners.delete(callback);}onMessage(callback){this.messageListeners.add(callback);return()=>this.messageListeners.delete(callback);}sendMessage(message){var _this$socket;if(((_this$socket=this.socket)===null||_this$socket===void 0?void 0:_this$socket.readyState)===WebSocket.OPEN){this.socket.send(JSON.stringify(message));return true;}return false;}emit(event,data){this.sendMessage({type:event,data});}on(event,callback){// For compatibility with socket.io-like API\nthis.messageListeners.add(callback);return()=>this.messageListeners.delete(callback);}off(event,callback){this.messageListeners.delete(callback);}attemptReconnect(){if(this.reconnectAttempts<this.maxReconnectAttempts){this.reconnectAttempts++;console.log(\"Attempting to reconnect (\".concat(this.reconnectAttempts,\"/\").concat(this.maxReconnectAttempts,\")\"));setTimeout(()=>this.connect(),this.reconnectDelay*this.reconnectAttempts);}}}export const webSocketService=new WebSocketService();// Initialize WebSocket connection when the service is imported\nif(typeof window!=='undefined'){webSocketService.connect();}","map":{"version":3,"names":["WS_URL","process","env","REACT_APP_WS_URL","WebSocketService","constructor","socket","messageListeners","Set","reconnectAttempts","maxReconnectAttempts","reconnectDelay","connect","namespace","arguments","length","undefined","token","authToken","localStorage","getItem","console","error","WebSocket","concat","onopen","log","onmessage","event","data","JSON","parse","forEach","listener","onerror","onclose","attemptReconnect","disconnect","close","subscribe","callback","add","delete","onMessage","sendMessage","message","_this$socket","readyState","OPEN","send","stringify","emit","type","on","off","setTimeout","webSocketService","window"],"sources":["C:/Users/THILOCIGAN/Documents/super_app-main_2/super_app-main/urban-partner-app/src/services/websocket.js"],"sourcesContent":["const WS_URL = process.env.REACT_APP_WS_URL || 'ws://localhost:5000';\r\n\r\nclass WebSocketService {\r\n  constructor() {\r\n    this.socket = null;\r\n    this.messageListeners = new Set();\r\n    this.reconnectAttempts = 0;\r\n    this.maxReconnectAttempts = 5;\r\n    this.reconnectDelay = 1000; // 1 second\r\n  }\r\n\r\n  connect(namespace = '/partner', token = null) {\r\n    if (this.socket) return;\r\n\r\n    const authToken = token || localStorage.getItem('partnerToken') || localStorage.getItem('token') || localStorage.getItem('authToken');\r\n    if (!authToken) {\r\n      console.error('No authentication token found');\r\n      return;\r\n    }\r\n\r\n    this.socket = new WebSocket(`${WS_URL}${namespace}?token=${authToken}`);\r\n\r\n    this.socket.onopen = () => {\r\n      console.log('WebSocket Connected');\r\n      this.reconnectAttempts = 0;\r\n    };\r\n\r\n    this.socket.onmessage = (event) => {\r\n      try {\r\n        const data = JSON.parse(event.data);\r\n        this.messageListeners.forEach(listener => listener(data));\r\n      } catch (error) {\r\n        console.error('Error parsing WebSocket message:', error);\r\n      }\r\n    };\r\n\r\n    this.socket.onerror = (error) => {\r\n      console.error('WebSocket error:', error);\r\n    };\r\n\r\n    this.socket.onclose = () => {\r\n      console.log('WebSocket Disconnected');\r\n      this.socket = null;\r\n      this.attemptReconnect();\r\n    };\r\n  }\r\n\r\n  disconnect() {\r\n    if (this.socket) {\r\n      this.socket.close();\r\n      this.socket = null;\r\n    }\r\n  }\r\n\r\n  subscribe(callback) {\r\n    this.messageListeners.add(callback);\r\n    return () => this.messageListeners.delete(callback);\r\n  }\r\n\r\n  onMessage(callback) {\r\n    this.messageListeners.add(callback);\r\n    return () => this.messageListeners.delete(callback);\r\n  }\r\n\r\n  sendMessage(message) {\r\n    if (this.socket?.readyState === WebSocket.OPEN) {\r\n      this.socket.send(JSON.stringify(message));\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  emit(event, data) {\r\n    this.sendMessage({ type: event, data });\r\n  }\r\n\r\n  on(event, callback) {\r\n    // For compatibility with socket.io-like API\r\n    this.messageListeners.add(callback);\r\n    return () => this.messageListeners.delete(callback);\r\n  }\r\n\r\n  off(event, callback) {\r\n    this.messageListeners.delete(callback);\r\n  }\r\n\r\n  attemptReconnect() {\r\n    if (this.reconnectAttempts < this.maxReconnectAttempts) {\r\n      this.reconnectAttempts++;\r\n      console.log(`Attempting to reconnect (${this.reconnectAttempts}/${this.maxReconnectAttempts})`);\r\n      setTimeout(() => this.connect(), this.reconnectDelay * this.reconnectAttempts);\r\n    }\r\n  }\r\n}\r\n\r\nexport const webSocketService = new WebSocketService();\r\n\r\n// Initialize WebSocket connection when the service is imported\r\nif (typeof window !== 'undefined') {\r\n  webSocketService.connect();\r\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}