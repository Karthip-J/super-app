{"ast":null,"code":"class WebSocketService {\n  constructor() {\n    this.socket = null;\n    this.messageListeners = new Set();\n    this.reconnectAttempts = 0;\n    this.maxReconnectAttempts = 5;\n    this.reconnectDelay = 1000; // 1 second\n  }\n  connect() {\n    if (this.socket) return;\n    const token = localStorage.getItem('token') || localStorage.getItem('authToken');\n    if (!token) {\n      console.error('No authentication token found');\n      return;\n    }\n    this.socket = new WebSocket(`${WS_URL}/partner?token=${token}`);\n    this.socket.onopen = () => {\n      console.log('WebSocket Connected');\n      this.reconnectAttempts = 0;\n    };\n    this.socket.onmessage = event => {\n      try {\n        const data = JSON.parse(event.data);\n        this.messageListeners.forEach(listener => listener(data));\n      } catch (error) {\n        console.error('Error parsing WebSocket message:', error);\n      }\n    };\n    this.socket.onerror = error => {\n      console.error('WebSocket error:', error);\n    };\n    this.socket.onclose = () => {\n      console.log('WebSocket Disconnected');\n      this.socket = null;\n      this.attemptReconnect();\n    };\n  }\n  disconnect() {\n    if (this.socket) {\n      this.socket.close();\n      this.socket = null;\n    }\n  }\n  subscribe(callback) {\n    this.messageListeners.add(callback);\n    return () => this.messageListeners.delete(callback);\n  }\n  sendMessage(message) {\n    var _this$socket;\n    if (((_this$socket = this.socket) === null || _this$socket === void 0 ? void 0 : _this$socket.readyState) === WebSocket.OPEN) {\n      this.socket.send(JSON.stringify(message));\n      return true;\n    }\n    return false;\n  }\n  attemptReconnect() {\n    if (this.reconnectAttempts < this.maxReconnectAttempts) {\n      this.reconnectAttempts++;\n      console.log(`Attempting to reconnect (${this.reconnectAttempts}/${this.maxReconnectAttempts})`);\n      setTimeout(() => this.connect(), this.reconnectDelay * this.reconnectAttempts);\n    }\n  }\n}\nexport const webSocketService = new WebSocketService();\n\n// Initialize WebSocket connection when the service is imported\nif (typeof window !== 'undefined') {\n  webSocketService.connect();\n}","map":{"version":3,"names":["WebSocketService","constructor","socket","messageListeners","Set","reconnectAttempts","maxReconnectAttempts","reconnectDelay","connect","token","localStorage","getItem","console","error","WebSocket","WS_URL","onopen","log","onmessage","event","data","JSON","parse","forEach","listener","onerror","onclose","attemptReconnect","disconnect","close","subscribe","callback","add","delete","sendMessage","message","_this$socket","readyState","OPEN","send","stringify","setTimeout","webSocketService","window"],"sources":["D:/SUPER APP MAIN NEW/SUPER APP MAIN NEW/super_app-main/urban-partner-app/src/services/websocket.js"],"sourcesContent":["class WebSocketService {\r\n  constructor() {\r\n    this.socket = null;\r\n    this.messageListeners = new Set();\r\n    this.reconnectAttempts = 0;\r\n    this.maxReconnectAttempts = 5;\r\n    this.reconnectDelay = 1000; // 1 second\r\n  }\r\n\r\n  connect() {\r\n    if (this.socket) return;\r\n\r\n    const token = localStorage.getItem('token') || localStorage.getItem('authToken');\r\n    if (!token) {\r\n      console.error('No authentication token found');\r\n      return;\r\n    }\r\n\r\n    this.socket = new WebSocket(`${WS_URL}/partner?token=${token}`);\r\n\r\n    this.socket.onopen = () => {\r\n      console.log('WebSocket Connected');\r\n      this.reconnectAttempts = 0;\r\n    };\r\n\r\n    this.socket.onmessage = (event) => {\r\n      try {\r\n        const data = JSON.parse(event.data);\r\n        this.messageListeners.forEach(listener => listener(data));\r\n      } catch (error) {\r\n        console.error('Error parsing WebSocket message:', error);\r\n      }\r\n    };\r\n\r\n    this.socket.onerror = (error) => {\r\n      console.error('WebSocket error:', error);\r\n    };\r\n\r\n    this.socket.onclose = () => {\r\n      console.log('WebSocket Disconnected');\r\n      this.socket = null;\r\n      this.attemptReconnect();\r\n    };\r\n  }\r\n\r\n  disconnect() {\r\n    if (this.socket) {\r\n      this.socket.close();\r\n      this.socket = null;\r\n    }\r\n  }\r\n\r\n  subscribe(callback) {\r\n    this.messageListeners.add(callback);\r\n    return () => this.messageListeners.delete(callback);\r\n  }\r\n\r\n  sendMessage(message) {\r\n    if (this.socket?.readyState === WebSocket.OPEN) {\r\n      this.socket.send(JSON.stringify(message));\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  attemptReconnect() {\r\n    if (this.reconnectAttempts < this.maxReconnectAttempts) {\r\n      this.reconnectAttempts++;\r\n      console.log(`Attempting to reconnect (${this.reconnectAttempts}/${this.maxReconnectAttempts})`);\r\n      setTimeout(() => this.connect(), this.reconnectDelay * this.reconnectAttempts);\r\n    }\r\n  }\r\n}\r\n\r\nexport const webSocketService = new WebSocketService();\r\n\r\n// Initialize WebSocket connection when the service is imported\r\nif (typeof window !== 'undefined') {\r\n  webSocketService.connect();\r\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}