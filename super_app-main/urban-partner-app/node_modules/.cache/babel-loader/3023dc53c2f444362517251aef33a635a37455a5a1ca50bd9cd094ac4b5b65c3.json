{"ast":null,"code":"const WS_URL = process.env.REACT_APP_WS_URL || 'ws://localhost:5000';\nclass WebSocketService {\n  constructor() {\n    this.socket = null;\n    this.messageListeners = new Set();\n    this.reconnectAttempts = 0;\n    this.maxReconnectAttempts = 5;\n    this.reconnectDelay = 1000; // 1 second\n  }\n  connect(namespace = '/partner', token = null) {\n    if (this.socket) return;\n    const authToken = token || localStorage.getItem('partnerToken') || localStorage.getItem('token') || localStorage.getItem('authToken');\n    if (!authToken) {\n      console.error('No authentication token found');\n      return;\n    }\n    this.socket = new WebSocket(`${WS_URL}${namespace}?token=${authToken}`);\n    this.socket.onopen = () => {\n      console.log('WebSocket Connected');\n      this.reconnectAttempts = 0;\n    };\n    this.socket.onmessage = event => {\n      try {\n        const data = JSON.parse(event.data);\n        this.messageListeners.forEach(listener => listener(data));\n      } catch (error) {\n        console.error('Error parsing WebSocket message:', error);\n      }\n    };\n    this.socket.onerror = error => {\n      console.error('WebSocket error:', error);\n    };\n    this.socket.onclose = () => {\n      console.log('WebSocket Disconnected');\n      this.socket = null;\n      this.attemptReconnect();\n    };\n  }\n  disconnect() {\n    if (this.socket) {\n      this.socket.close();\n      this.socket = null;\n    }\n  }\n  subscribe(callback) {\n    this.messageListeners.add(callback);\n    return () => this.messageListeners.delete(callback);\n  }\n  onMessage(callback) {\n    this.messageListeners.add(callback);\n    return () => this.messageListeners.delete(callback);\n  }\n  sendMessage(message) {\n    var _this$socket;\n    if (((_this$socket = this.socket) === null || _this$socket === void 0 ? void 0 : _this$socket.readyState) === WebSocket.OPEN) {\n      this.socket.send(JSON.stringify(message));\n      return true;\n    }\n    return false;\n  }\n  emit(event, data) {\n    this.sendMessage({\n      type: event,\n      data\n    });\n  }\n  on(event, callback) {\n    // For compatibility with socket.io-like API\n    this.messageListeners.add(callback);\n    return () => this.messageListeners.delete(callback);\n  }\n  off(event, callback) {\n    this.messageListeners.delete(callback);\n  }\n  attemptReconnect() {\n    if (this.reconnectAttempts < this.maxReconnectAttempts) {\n      this.reconnectAttempts++;\n      console.log(`Attempting to reconnect (${this.reconnectAttempts}/${this.maxReconnectAttempts})`);\n      setTimeout(() => this.connect(), this.reconnectDelay * this.reconnectAttempts);\n    }\n  }\n}\nexport const webSocketService = new WebSocketService();\n\n// Initialize WebSocket connection when the service is imported\nif (typeof window !== 'undefined') {\n  webSocketService.connect();\n}","map":{"version":3,"names":["WS_URL","process","env","REACT_APP_WS_URL","WebSocketService","constructor","socket","messageListeners","Set","reconnectAttempts","maxReconnectAttempts","reconnectDelay","connect","namespace","token","authToken","localStorage","getItem","console","error","WebSocket","onopen","log","onmessage","event","data","JSON","parse","forEach","listener","onerror","onclose","attemptReconnect","disconnect","close","subscribe","callback","add","delete","onMessage","sendMessage","message","_this$socket","readyState","OPEN","send","stringify","emit","type","on","off","setTimeout","webSocketService","window"],"sources":["C:/Users/THILOCIGAN/Documents/super_app-main_2/super_app-main/urban-partner-app/src/services/websocket.js"],"sourcesContent":["const WS_URL = process.env.REACT_APP_WS_URL || 'ws://localhost:5000';\r\n\r\nclass WebSocketService {\r\n  constructor() {\r\n    this.socket = null;\r\n    this.messageListeners = new Set();\r\n    this.reconnectAttempts = 0;\r\n    this.maxReconnectAttempts = 5;\r\n    this.reconnectDelay = 1000; // 1 second\r\n  }\r\n\r\n  connect(namespace = '/partner', token = null) {\r\n    if (this.socket) return;\r\n\r\n    const authToken = token || localStorage.getItem('partnerToken') || localStorage.getItem('token') || localStorage.getItem('authToken');\r\n    if (!authToken) {\r\n      console.error('No authentication token found');\r\n      return;\r\n    }\r\n\r\n    this.socket = new WebSocket(`${WS_URL}${namespace}?token=${authToken}`);\r\n\r\n    this.socket.onopen = () => {\r\n      console.log('WebSocket Connected');\r\n      this.reconnectAttempts = 0;\r\n    };\r\n\r\n    this.socket.onmessage = (event) => {\r\n      try {\r\n        const data = JSON.parse(event.data);\r\n        this.messageListeners.forEach(listener => listener(data));\r\n      } catch (error) {\r\n        console.error('Error parsing WebSocket message:', error);\r\n      }\r\n    };\r\n\r\n    this.socket.onerror = (error) => {\r\n      console.error('WebSocket error:', error);\r\n    };\r\n\r\n    this.socket.onclose = () => {\r\n      console.log('WebSocket Disconnected');\r\n      this.socket = null;\r\n      this.attemptReconnect();\r\n    };\r\n  }\r\n\r\n  disconnect() {\r\n    if (this.socket) {\r\n      this.socket.close();\r\n      this.socket = null;\r\n    }\r\n  }\r\n\r\n  subscribe(callback) {\r\n    this.messageListeners.add(callback);\r\n    return () => this.messageListeners.delete(callback);\r\n  }\r\n\r\n  onMessage(callback) {\r\n    this.messageListeners.add(callback);\r\n    return () => this.messageListeners.delete(callback);\r\n  }\r\n\r\n  sendMessage(message) {\r\n    if (this.socket?.readyState === WebSocket.OPEN) {\r\n      this.socket.send(JSON.stringify(message));\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  emit(event, data) {\r\n    this.sendMessage({ type: event, data });\r\n  }\r\n\r\n  on(event, callback) {\r\n    // For compatibility with socket.io-like API\r\n    this.messageListeners.add(callback);\r\n    return () => this.messageListeners.delete(callback);\r\n  }\r\n\r\n  off(event, callback) {\r\n    this.messageListeners.delete(callback);\r\n  }\r\n\r\n  attemptReconnect() {\r\n    if (this.reconnectAttempts < this.maxReconnectAttempts) {\r\n      this.reconnectAttempts++;\r\n      console.log(`Attempting to reconnect (${this.reconnectAttempts}/${this.maxReconnectAttempts})`);\r\n      setTimeout(() => this.connect(), this.reconnectDelay * this.reconnectAttempts);\r\n    }\r\n  }\r\n}\r\n\r\nexport const webSocketService = new WebSocketService();\r\n\r\n// Initialize WebSocket connection when the service is imported\r\nif (typeof window !== 'undefined') {\r\n  webSocketService.connect();\r\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}