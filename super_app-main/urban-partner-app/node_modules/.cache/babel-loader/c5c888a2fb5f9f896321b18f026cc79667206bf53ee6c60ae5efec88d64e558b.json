{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\karthip\\\\Downloads\\\\super_app-main-5 (1)\\\\super_app-main-5\\\\super_app-main\\\\urban-partner-app\\\\src\\\\screens\\\\auth\\\\OTPVerification.jsx\",\n  _s = $RefreshSig$();\nimport React, { useState, useRef, useEffect } from 'react';\nimport { useNavigate, useLocation } from 'react-router-dom';\nimport authService from '../../services/authService';\nimport api from '../../services/api';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst OTPVerification = () => {\n  _s();\n  const [otp, setOtp] = useState(['', '', '', '', '', '']);\n  const [loading, setLoading] = useState(false);\n  const [timeLeft, setTimeLeft] = useState(60);\n  const [canResend, setCanResend] = useState(false);\n  const [showOtpDisplay, setShowOtpDisplay] = useState(true);\n  const [devOtp, setDevOtp] = useState('');\n  const navigate = useNavigate();\n  const location = useLocation();\n\n  // Debug the entire location state\n  console.log('Full location object:', location);\n  console.log('Location state:', location.state);\n  const {\n    phone,\n    isNewPartner,\n    isApproved\n  } = location.state || {};\n  console.log('Extracted phone:', phone);\n  console.log('Extracted isNewPartner:', isNewPartner);\n  console.log('Extracted isApproved:', isApproved);\n  const otpInputs = useRef([]);\n\n  // Fetch latest OTP for dev display\n  useEffect(() => {\n    const fetchDevOtp = async () => {\n      console.log('Fetching OTP for phone:', phone);\n      if (phone) {\n        try {\n          // Try multiple endpoints to find the correct one\n          const endpoints = [`http://localhost:3000/api/auth/otp/latest?phone=${phone}`, `http://localhost:3000/api/otp/latest?phone=${phone}`, `/auth/otp/latest?phone=${phone}`, `/otp/latest?phone=${phone}`];\n          for (const endpoint of endpoints) {\n            try {\n              console.log('Trying endpoint:', endpoint);\n              const response = await fetch(endpoint);\n              console.log('Response status:', response.status);\n              if (response.ok) {\n                const data = await response.json();\n                console.log('API Response:', data);\n                if (data.success && data.otp) {\n                  console.log('Setting OTP:', data.otp);\n                  setDevOtp(data.otp);\n                  return; // Success, exit the loop\n                }\n              }\n            } catch (error) {\n              console.log('Endpoint failed:', endpoint, error);\n              continue; // Try next endpoint\n            }\n          }\n\n          // If all endpoints fail, try to extract OTP from console logs\n          console.log('All endpoints failed, trying alternative method');\n          // For development, we can try to get the OTP from localStorage or a mock\n          const mockOtp = '427521'; // Fallback for testing\n          console.log('Using fallback OTP:', mockOtp);\n          setDevOtp(mockOtp);\n        } catch (error) {\n          console.log('Could not fetch latest OTP:', error);\n          // Set a fallback OTP for testing\n          setDevOtp('427521');\n        }\n      } else {\n        console.log('No phone number available');\n      }\n    };\n    fetchDevOtp();\n  }, [phone]);\n  useEffect(() => {\n    if (timeLeft > 0) {\n      const timer = setTimeout(() => setTimeLeft(timeLeft - 1), 1000);\n      return () => clearTimeout(timer);\n    } else {\n      setCanResend(true);\n    }\n  }, [timeLeft]);\n  const handleOtpChange = (index, value) => {\n    if (value.length > 1) return;\n    const newOtp = [...otp];\n    newOtp[index] = value;\n    setOtp(newOtp);\n\n    // Auto-focus next input\n    if (value && index < 5) {\n      var _otpInputs$current;\n      (_otpInputs$current = otpInputs.current[index + 1]) === null || _otpInputs$current === void 0 ? void 0 : _otpInputs$current.focus();\n    }\n  };\n  const handleKeyDown = (index, e) => {\n    if (e.key === 'Backspace' && !otp[index] && index > 0) {\n      var _otpInputs$current2;\n      (_otpInputs$current2 = otpInputs.current[index - 1]) === null || _otpInputs$current2 === void 0 ? void 0 : _otpInputs$current2.focus();\n    }\n  };\n  const handleVerifyOTP = async e => {\n    e.preventDefault();\n    const otpString = otp.join('');\n    if (otpString.length !== 6) {\n      alert('Please enter a valid 6-digit OTP');\n      return;\n    }\n    try {\n      setLoading(true);\n      const response = await authService.verifyOTP(phone, otpString);\n      if (response.success && response.token) {\n        // Token is already stored by authService\n\n        // Save phone number for DocumentUpload screen\n        localStorage.setItem('phoneNumber', phone);\n\n        // Check partner status to determine navigation\n        const status = response.partner.status;\n        const documentsUploaded = response.partner.documentsUploaded;\n        if (status === 'active' || status === 'approved') {\n          navigate('/dashboard');\n        } else if (status === 'pending' && documentsUploaded) {\n          // If pending but documents are already uploaded, go to status check page\n          navigate('/approval-pending');\n        } else {\n          // For pending/new partners without docs, go to document upload\n          navigate('/document-upload');\n        }\n      } else {\n        alert(response.message || 'OTP verification failed. Please try again.');\n      }\n    } catch (error) {\n      var _error$response, _error$response$data;\n      console.error('Error:', error);\n      alert(((_error$response = error.response) === null || _error$response === void 0 ? void 0 : (_error$response$data = _error$response.data) === null || _error$response$data === void 0 ? void 0 : _error$response$data.message) || 'Invalid OTP. Please try again.');\n    } finally {\n      setLoading(false);\n    }\n  };\n  const handleResendOTP = async () => {\n    try {\n      var _otpInputs$current$;\n      setLoading(true);\n      await authService.sendOTP(phone);\n      setTimeLeft(60);\n      setCanResend(false);\n      setOtp(['', '', '', '', '', '']);\n      (_otpInputs$current$ = otpInputs.current[0]) === null || _otpInputs$current$ === void 0 ? void 0 : _otpInputs$current$.focus();\n\n      // Fetch and update dev OTP after resend using same multi-endpoint approach\n      try {\n        const endpoints = [`http://localhost:3000/api/auth/otp/latest?phone=${phone}`, `http://localhost:3000/api/otp/latest?phone=${phone}`, `/auth/otp/latest?phone=${phone}`, `/otp/latest?phone=${phone}`];\n        for (const endpoint of endpoints) {\n          try {\n            const response = await fetch(endpoint);\n            if (response.ok) {\n              const data = await response.json();\n              if (data.success && data.otp) {\n                setDevOtp(data.otp);\n                setShowOtpDisplay(true);\n                return;\n              }\n            }\n          } catch (error) {\n            continue;\n          }\n        }\n\n        // Fallback\n        setDevOtp('427521');\n        setShowOtpDisplay(true);\n      } catch (error) {\n        console.log('Could not fetch latest OTP:', error);\n        setDevOtp('427521');\n        setShowOtpDisplay(true);\n      }\n      alert('OTP sent successfully');\n    } catch (error) {\n      console.error('Error:', error);\n      alert('Failed to resend OTP. Please try again.');\n    } finally {\n      setLoading(false);\n    }\n  };\n  const copyOtpToClipboard = () => {\n    if (devOtp) {\n      navigator.clipboard.writeText(devOtp).then(() => {\n        alert('OTP copied to clipboard!');\n      }).catch(() => {\n        alert('Failed to copy OTP. Please copy manually: ' + devOtp);\n      });\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4\",\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"bg-white rounded-2xl shadow-xl p-8 w-full max-w-md\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"mb-4 p-2 bg-gray-100 rounded text-xs\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          children: [\"Location State: \", JSON.stringify(location.state)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 221,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          children: [\"Phone: \", phone || 'Not available']\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 222,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          children: [\"Dev OTP: \", devOtp || 'Not set']\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 223,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          children: [\"Show Display: \", showOtpDisplay ? 'Yes' : 'No']\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 224,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          children: [\"Display Condition: \", showOtpDisplay && devOtp ? 'True' : 'False']\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 225,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 220,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"text-center mb-8\",\n        children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n          className: \"text-2xl font-bold text-gray-900\",\n          children: \"Verify OTP\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 229,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"text-gray-600 mt-2\",\n          children: [\"Enter the 6-digit code sent to \", phone]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 230,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 228,\n        columnNumber: 9\n      }, this), showOtpDisplay && devOtp && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"mb-6\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"bg-gray-900 rounded-lg p-4 font-mono text-sm\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"flex items-center justify-between mb-2\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"flex items-center space-x-2\",\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"w-3 h-3 bg-red-500 rounded-full\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 239,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"w-3 h-3 bg-yellow-500 rounded-full\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 240,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"w-3 h-3 bg-green-500 rounded-full\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 241,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"text-gray-400 text-xs ml-2\",\n                children: \"Console\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 242,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 238,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n              onClick: () => setShowOtpDisplay(false),\n              className: \"text-gray-400 hover:text-white text-xs\",\n              children: \"\\xD7\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 244,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 237,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"space-y-1\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"text-green-400\",\n              children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"text-gray-500\",\n                children: '>'\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 253,\n                columnNumber: 19\n              }, this), \" \", /*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"text-blue-400\",\n                children: \"const\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 253,\n                columnNumber: 64\n              }, this), \" \", /*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"text-yellow-300\",\n                children: \"otp\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 253,\n                columnNumber: 109\n              }, this), \" = \", /*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"text-orange-400\",\n                children: \"'123456'\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 253,\n                columnNumber: 156\n              }, this), \";\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 252,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"text-green-400\",\n              children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"text-gray-500\",\n                children: '>'\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 256,\n                columnNumber: 19\n              }, this), \" \", /*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"text-blue-400\",\n                children: \"console\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 256,\n                columnNumber: 64\n              }, this), \".\", /*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"text-yellow-300\",\n                children: \"log\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 256,\n                columnNumber: 111\n              }, this), \"(\", /*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"text-orange-400\",\n                children: \"'Your OTP is:'\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 256,\n                columnNumber: 156\n              }, this), \", \", /*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"text-yellow-300\",\n                children: \"otp\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 256,\n                columnNumber: 213\n              }, this), \");\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 255,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"text-white\",\n              children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"text-gray-500\",\n                children: '>'\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 259,\n                columnNumber: 19\n              }, this), \" Your OTP is: \", /*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"text-green-400 font-bold text-lg\",\n                children: devOtp\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 259,\n                columnNumber: 77\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 258,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"text-gray-500 text-xs mt-2\",\n              children: new Date().toLocaleTimeString()\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 261,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 251,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"mt-3 pt-3 border-t border-gray-700 flex space-x-2\",\n            children: [/*#__PURE__*/_jsxDEV(\"button\", {\n              onClick: copyOtpToClipboard,\n              className: \"px-3 py-1 bg-blue-600 text-white text-xs rounded hover:bg-blue-700 transition-colors\",\n              children: \"Copy OTP\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 266,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n              onClick: () => {\n                const otpArray = devOtp.split('');\n                setOtp(otpArray);\n                setTimeout(() => {\n                  var _otpInputs$current3;\n                  (_otpInputs$current3 = otpInputs.current[otpArray.length - 1]) === null || _otpInputs$current3 === void 0 ? void 0 : _otpInputs$current3.focus();\n                }, 100);\n              },\n              className: \"px-3 py-1 bg-green-600 text-white text-xs rounded hover:bg-green-700 transition-colors\",\n              children: \"Auto-fill\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 272,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 265,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 236,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 235,\n        columnNumber: 11\n      }, this), !showOtpDisplay && devOtp && /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: () => setShowOtpDisplay(true),\n        className: \"w-full mb-6 p-3 bg-gray-900 text-green-400 rounded-lg hover:bg-gray-800 transition-colors flex items-center justify-center space-x-2 font-mono text-sm\",\n        children: [/*#__PURE__*/_jsxDEV(\"svg\", {\n          className: \"w-4 h-4\",\n          fill: \"none\",\n          stroke: \"currentColor\",\n          viewBox: \"0 0 24 24\",\n          children: /*#__PURE__*/_jsxDEV(\"path\", {\n            strokeLinecap: \"round\",\n            strokeLinejoin: \"round\",\n            strokeWidth: \"2\",\n            d: \"M8 9l3 3-3 3m5 0h3M5 20h14a2 2 0 002-2V6a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 296,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 295,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n          children: \"Show Console OTP\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 298,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 291,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"form\", {\n        onSubmit: handleVerifyOTP,\n        className: \"space-y-6\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"flex justify-center space-x-2\",\n          children: otp.map((digit, index) => /*#__PURE__*/_jsxDEV(\"input\", {\n            ref: el => otpInputs.current[index] = el,\n            type: \"text\",\n            value: digit,\n            onChange: e => handleOtpChange(index, e.target.value),\n            onKeyDown: e => handleKeyDown(index, e),\n            className: \"w-12 h-12 text-center text-lg font-semibold border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none\",\n            maxLength: 1,\n            required: true\n          }, index, false, {\n            fileName: _jsxFileName,\n            lineNumber: 305,\n            columnNumber: 15\n          }, this))\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 303,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          type: \"submit\",\n          disabled: loading || otp.join('').length !== 6,\n          className: \"w-full bg-blue-600 text-white py-3 px-4 rounded-lg font-medium hover:bg-blue-700 transition duration-200 disabled:opacity-50 disabled:cursor-not-allowed\",\n          children: loading ? 'Verifying...' : 'Verify OTP'\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 319,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"text-center\",\n          children: /*#__PURE__*/_jsxDEV(\"button\", {\n            type: \"button\",\n            onClick: handleResendOTP,\n            disabled: !canResend || loading,\n            className: \"text-blue-600 hover:text-blue-700 text-sm disabled:opacity-50 disabled:cursor-not-allowed\",\n            children: canResend ? 'Resend OTP' : `Resend OTP in ${timeLeft}s`\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 328,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 327,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 302,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"mt-6 text-center\",\n        children: /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: () => navigate('/'),\n          className: \"text-gray-600 hover:text-gray-700 text-sm\",\n          children: \"\\u2190 Back to Mobile Number\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 340,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 339,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 218,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 217,\n    columnNumber: 5\n  }, this);\n};\n_s(OTPVerification, \"k72UaMxtb3YEx8ujprjt+Fu8hMY=\", false, function () {\n  return [useNavigate, useLocation];\n});\n_c = OTPVerification;\nexport default OTPVerification;\nvar _c;\n$RefreshReg$(_c, \"OTPVerification\");","map":{"version":3,"names":["React","useState","useRef","useEffect","useNavigate","useLocation","authService","api","jsxDEV","_jsxDEV","OTPVerification","_s","otp","setOtp","loading","setLoading","timeLeft","setTimeLeft","canResend","setCanResend","showOtpDisplay","setShowOtpDisplay","devOtp","setDevOtp","navigate","location","console","log","state","phone","isNewPartner","isApproved","otpInputs","fetchDevOtp","endpoints","endpoint","response","fetch","status","ok","data","json","success","error","mockOtp","timer","setTimeout","clearTimeout","handleOtpChange","index","value","length","newOtp","_otpInputs$current","current","focus","handleKeyDown","e","key","_otpInputs$current2","handleVerifyOTP","preventDefault","otpString","join","alert","verifyOTP","token","localStorage","setItem","partner","documentsUploaded","message","_error$response","_error$response$data","handleResendOTP","_otpInputs$current$","sendOTP","copyOtpToClipboard","navigator","clipboard","writeText","then","catch","className","children","JSON","stringify","fileName","_jsxFileName","lineNumber","columnNumber","onClick","Date","toLocaleTimeString","otpArray","split","_otpInputs$current3","fill","stroke","viewBox","strokeLinecap","strokeLinejoin","strokeWidth","d","onSubmit","map","digit","ref","el","type","onChange","target","onKeyDown","maxLength","required","disabled","_c","$RefreshReg$"],"sources":["C:/Users/karthip/Downloads/super_app-main-5 (1)/super_app-main-5/super_app-main/urban-partner-app/src/screens/auth/OTPVerification.jsx"],"sourcesContent":["import React, { useState, useRef, useEffect } from 'react';\r\nimport { useNavigate, useLocation } from 'react-router-dom';\r\nimport authService from '../../services/authService';\r\nimport api from '../../services/api';\r\n\r\nconst OTPVerification = () => {\r\n  const [otp, setOtp] = useState(['', '', '', '', '', '']);\r\n  const [loading, setLoading] = useState(false);\r\n  const [timeLeft, setTimeLeft] = useState(60);\r\n  const [canResend, setCanResend] = useState(false);\r\n  const [showOtpDisplay, setShowOtpDisplay] = useState(true);\r\n  const [devOtp, setDevOtp] = useState('');\r\n  const navigate = useNavigate();\r\n  const location = useLocation();\r\n  \r\n  // Debug the entire location state\r\n  console.log('Full location object:', location);\r\n  console.log('Location state:', location.state);\r\n  \r\n  const { phone, isNewPartner, isApproved } = location.state || {};\r\n  \r\n  console.log('Extracted phone:', phone);\r\n  console.log('Extracted isNewPartner:', isNewPartner);\r\n  console.log('Extracted isApproved:', isApproved);\r\n\r\n  const otpInputs = useRef([]);\r\n\r\n  // Fetch latest OTP for dev display\r\n  useEffect(() => {\r\n    const fetchDevOtp = async () => {\r\n      console.log('Fetching OTP for phone:', phone);\r\n      if (phone) {\r\n        try {\r\n          // Try multiple endpoints to find the correct one\r\n          const endpoints = [\r\n            `http://localhost:3000/api/auth/otp/latest?phone=${phone}`,\r\n            `http://localhost:3000/api/otp/latest?phone=${phone}`,\r\n            `/auth/otp/latest?phone=${phone}`,\r\n            `/otp/latest?phone=${phone}`\r\n          ];\r\n          \r\n          for (const endpoint of endpoints) {\r\n            try {\r\n              console.log('Trying endpoint:', endpoint);\r\n              const response = await fetch(endpoint);\r\n              console.log('Response status:', response.status);\r\n              \r\n              if (response.ok) {\r\n                const data = await response.json();\r\n                console.log('API Response:', data);\r\n                if (data.success && data.otp) {\r\n                  console.log('Setting OTP:', data.otp);\r\n                  setDevOtp(data.otp);\r\n                  return; // Success, exit the loop\r\n                }\r\n              }\r\n            } catch (error) {\r\n              console.log('Endpoint failed:', endpoint, error);\r\n              continue; // Try next endpoint\r\n            }\r\n          }\r\n          \r\n          // If all endpoints fail, try to extract OTP from console logs\r\n          console.log('All endpoints failed, trying alternative method');\r\n          // For development, we can try to get the OTP from localStorage or a mock\r\n          const mockOtp = '427521'; // Fallback for testing\r\n          console.log('Using fallback OTP:', mockOtp);\r\n          setDevOtp(mockOtp);\r\n          \r\n        } catch (error) {\r\n          console.log('Could not fetch latest OTP:', error);\r\n          // Set a fallback OTP for testing\r\n          setDevOtp('427521');\r\n        }\r\n      } else {\r\n        console.log('No phone number available');\r\n      }\r\n    };\r\n    fetchDevOtp();\r\n  }, [phone]);\r\n\r\n  useEffect(() => {\r\n    if (timeLeft > 0) {\r\n      const timer = setTimeout(() => setTimeLeft(timeLeft - 1), 1000);\r\n      return () => clearTimeout(timer);\r\n    } else {\r\n      setCanResend(true);\r\n    }\r\n  }, [timeLeft]);\r\n\r\n  const handleOtpChange = (index, value) => {\r\n    if (value.length > 1) return;\r\n\r\n    const newOtp = [...otp];\r\n    newOtp[index] = value;\r\n    setOtp(newOtp);\r\n\r\n    // Auto-focus next input\r\n    if (value && index < 5) {\r\n      otpInputs.current[index + 1]?.focus();\r\n    }\r\n  };\r\n\r\n  const handleKeyDown = (index, e) => {\r\n    if (e.key === 'Backspace' && !otp[index] && index > 0) {\r\n      otpInputs.current[index - 1]?.focus();\r\n    }\r\n  };\r\n\r\n  const handleVerifyOTP = async (e) => {\r\n    e.preventDefault();\r\n    const otpString = otp.join('');\r\n\r\n    if (otpString.length !== 6) {\r\n      alert('Please enter a valid 6-digit OTP');\r\n      return;\r\n    }\r\n\r\n    try {\r\n      setLoading(true);\r\n      const response = await authService.verifyOTP(phone, otpString);\r\n\r\n      if (response.success && response.token) {\r\n        // Token is already stored by authService\r\n\r\n        // Save phone number for DocumentUpload screen\r\n        localStorage.setItem('phoneNumber', phone);\r\n\r\n        // Check partner status to determine navigation\r\n        const status = response.partner.status;\r\n        const documentsUploaded = response.partner.documentsUploaded;\r\n\r\n        if (status === 'active' || status === 'approved') {\r\n          navigate('/dashboard');\r\n        } else if (status === 'pending' && documentsUploaded) {\r\n          // If pending but documents are already uploaded, go to status check page\r\n          navigate('/approval-pending');\r\n        } else {\r\n          // For pending/new partners without docs, go to document upload\r\n          navigate('/document-upload');\r\n        }\r\n      } else {\r\n        alert(response.message || 'OTP verification failed. Please try again.');\r\n      }\r\n    } catch (error) {\r\n      console.error('Error:', error);\r\n      alert(error.response?.data?.message || 'Invalid OTP. Please try again.');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleResendOTP = async () => {\r\n    try {\r\n      setLoading(true);\r\n      await authService.sendOTP(phone);\r\n      setTimeLeft(60);\r\n      setCanResend(false);\r\n      setOtp(['', '', '', '', '', '']);\r\n      otpInputs.current[0]?.focus();\r\n      \r\n      // Fetch and update dev OTP after resend using same multi-endpoint approach\r\n      try {\r\n        const endpoints = [\r\n          `http://localhost:3000/api/auth/otp/latest?phone=${phone}`,\r\n          `http://localhost:3000/api/otp/latest?phone=${phone}`,\r\n          `/auth/otp/latest?phone=${phone}`,\r\n          `/otp/latest?phone=${phone}`\r\n        ];\r\n        \r\n        for (const endpoint of endpoints) {\r\n          try {\r\n            const response = await fetch(endpoint);\r\n            if (response.ok) {\r\n              const data = await response.json();\r\n              if (data.success && data.otp) {\r\n                setDevOtp(data.otp);\r\n                setShowOtpDisplay(true);\r\n                return;\r\n              }\r\n            }\r\n          } catch (error) {\r\n            continue;\r\n          }\r\n        }\r\n        \r\n        // Fallback\r\n        setDevOtp('427521');\r\n        setShowOtpDisplay(true);\r\n        \r\n      } catch (error) {\r\n        console.log('Could not fetch latest OTP:', error);\r\n        setDevOtp('427521');\r\n        setShowOtpDisplay(true);\r\n      }\r\n      \r\n      alert('OTP sent successfully');\r\n    } catch (error) {\r\n      console.error('Error:', error);\r\n      alert('Failed to resend OTP. Please try again.');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const copyOtpToClipboard = () => {\r\n    if (devOtp) {\r\n      navigator.clipboard.writeText(devOtp).then(() => {\r\n        alert('OTP copied to clipboard!');\r\n      }).catch(() => {\r\n        alert('Failed to copy OTP. Please copy manually: ' + devOtp);\r\n      });\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4\">\r\n      <div className=\"bg-white rounded-2xl shadow-xl p-8 w-full max-w-md\">\r\n        {/* Debug info */}\r\n        <div className=\"mb-4 p-2 bg-gray-100 rounded text-xs\">\r\n          <div>Location State: {JSON.stringify(location.state)}</div>\r\n          <div>Phone: {phone || 'Not available'}</div>\r\n          <div>Dev OTP: {devOtp || 'Not set'}</div>\r\n          <div>Show Display: {showOtpDisplay ? 'Yes' : 'No'}</div>\r\n          <div>Display Condition: {showOtpDisplay && devOtp ? 'True' : 'False'}</div>\r\n        </div>\r\n        \r\n        <div className=\"text-center mb-8\">\r\n          <h1 className=\"text-2xl font-bold text-gray-900\">Verify OTP</h1>\r\n          <p className=\"text-gray-600 mt-2\">Enter the 6-digit code sent to {phone}</p>\r\n        </div>\r\n\r\n        {/* Console OTP Display */}\r\n        {showOtpDisplay && devOtp && (\r\n          <div className=\"mb-6\">\r\n            <div className=\"bg-gray-900 rounded-lg p-4 font-mono text-sm\">\r\n              <div className=\"flex items-center justify-between mb-2\">\r\n                <div className=\"flex items-center space-x-2\">\r\n                  <div className=\"w-3 h-3 bg-red-500 rounded-full\"></div>\r\n                  <div className=\"w-3 h-3 bg-yellow-500 rounded-full\"></div>\r\n                  <div className=\"w-3 h-3 bg-green-500 rounded-full\"></div>\r\n                  <span className=\"text-gray-400 text-xs ml-2\">Console</span>\r\n                </div>\r\n                <button\r\n                  onClick={() => setShowOtpDisplay(false)}\r\n                  className=\"text-gray-400 hover:text-white text-xs\"\r\n                >\r\n                  ×\r\n                </button>\r\n              </div>\r\n              <div className=\"space-y-1\">\r\n                <div className=\"text-green-400\">\r\n                  <span className=\"text-gray-500\">{'>'}</span> <span className=\"text-blue-400\">const</span> <span className=\"text-yellow-300\">otp</span> = <span className=\"text-orange-400\">'123456'</span>;\r\n                </div>\r\n                <div className=\"text-green-400\">\r\n                  <span className=\"text-gray-500\">{'>'}</span> <span className=\"text-blue-400\">console</span>.<span className=\"text-yellow-300\">log</span>(<span className=\"text-orange-400\">'Your OTP is:'</span>, <span className=\"text-yellow-300\">otp</span>);\r\n                </div>\r\n                <div className=\"text-white\">\r\n                  <span className=\"text-gray-500\">{'>'}</span> Your OTP is: <span className=\"text-green-400 font-bold text-lg\">{devOtp}</span>\r\n                </div>\r\n                <div className=\"text-gray-500 text-xs mt-2\">\r\n                  {new Date().toLocaleTimeString()}\r\n                </div>\r\n              </div>\r\n              <div className=\"mt-3 pt-3 border-t border-gray-700 flex space-x-2\">\r\n                <button\r\n                  onClick={copyOtpToClipboard}\r\n                  className=\"px-3 py-1 bg-blue-600 text-white text-xs rounded hover:bg-blue-700 transition-colors\"\r\n                >\r\n                  Copy OTP\r\n                </button>\r\n                <button\r\n                  onClick={() => {\r\n                    const otpArray = devOtp.split('');\r\n                    setOtp(otpArray);\r\n                    setTimeout(() => {\r\n                      otpInputs.current[otpArray.length - 1]?.focus();\r\n                    }, 100);\r\n                  }}\r\n                  className=\"px-3 py-1 bg-green-600 text-white text-xs rounded hover:bg-green-700 transition-colors\"\r\n                >\r\n                  Auto-fill\r\n                </button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        {/* Show OTP button (when hidden) */}\r\n        {!showOtpDisplay && devOtp && (\r\n          <button\r\n            onClick={() => setShowOtpDisplay(true)}\r\n            className=\"w-full mb-6 p-3 bg-gray-900 text-green-400 rounded-lg hover:bg-gray-800 transition-colors flex items-center justify-center space-x-2 font-mono text-sm\"\r\n          >\r\n            <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth=\"2\" d=\"M8 9l3 3-3 3m5 0h3M5 20h14a2 2 0 002-2V6a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z\"></path>\r\n            </svg>\r\n            <span>Show Console OTP</span>\r\n          </button>\r\n        )}\r\n\r\n        <form onSubmit={handleVerifyOTP} className=\"space-y-6\">\r\n          <div className=\"flex justify-center space-x-2\">\r\n            {otp.map((digit, index) => (\r\n              <input\r\n                key={index}\r\n                ref={(el) => (otpInputs.current[index] = el)}\r\n                type=\"text\"\r\n                value={digit}\r\n                onChange={(e) => handleOtpChange(index, e.target.value)}\r\n                onKeyDown={(e) => handleKeyDown(index, e)}\r\n                className=\"w-12 h-12 text-center text-lg font-semibold border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none\"\r\n                maxLength={1}\r\n                required\r\n              />\r\n            ))}\r\n          </div>\r\n\r\n          <button\r\n            type=\"submit\"\r\n            disabled={loading || otp.join('').length !== 6}\r\n            className=\"w-full bg-blue-600 text-white py-3 px-4 rounded-lg font-medium hover:bg-blue-700 transition duration-200 disabled:opacity-50 disabled:cursor-not-allowed\"\r\n          >\r\n            {loading ? 'Verifying...' : 'Verify OTP'}\r\n          </button>\r\n\r\n          <div className=\"text-center\">\r\n            <button\r\n              type=\"button\"\r\n              onClick={handleResendOTP}\r\n              disabled={!canResend || loading}\r\n              className=\"text-blue-600 hover:text-blue-700 text-sm disabled:opacity-50 disabled:cursor-not-allowed\"\r\n            >\r\n              {canResend ? 'Resend OTP' : `Resend OTP in ${timeLeft}s`}\r\n            </button>\r\n          </div>\r\n        </form>\r\n\r\n        <div className=\"mt-6 text-center\">\r\n          <button\r\n            onClick={() => navigate('/')}\r\n            className=\"text-gray-600 hover:text-gray-700 text-sm\"\r\n          >\r\n            ← Back to Mobile Number\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default OTPVerification;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}