{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\karthip\\\\Downloads\\\\super_app-main-5 (1)\\\\super_app-main-5\\\\super_app-main\\\\urban-partner-app\\\\src\\\\screens\\\\auth\\\\OTPVerification.jsx\",\n  _s = $RefreshSig$();\nimport React, { useState, useRef, useEffect } from 'react';\nimport { useNavigate, useLocation } from 'react-router-dom';\nimport authService from '../../services/authService';\nimport api from '../../services/api';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst OTPVerification = () => {\n  _s();\n  const [otp, setOtp] = useState(['', '', '', '', '', '']);\n  const [loading, setLoading] = useState(false);\n  const [timeLeft, setTimeLeft] = useState(60);\n  const [canResend, setCanResend] = useState(false);\n  const [showOtpDisplay, setShowOtpDisplay] = useState(true);\n  const [devOtp, setDevOtp] = useState('');\n  const navigate = useNavigate();\n  const location = useLocation();\n  const {\n    phone,\n    isNewPartner,\n    isApproved\n  } = location.state || {};\n\n  // Fallback: try to get phone from localStorage if location.state is null\n  const fallbackPhone = phone || localStorage.getItem('pendingPhone') || '+918610097038';\n  const otpInputs = useRef([]);\n\n  // Fetch latest OTP for dev display\n  useEffect(() => {\n    const fetchDevOtp = async () => {\n      console.log('Fetching OTP for phone:', fallbackPhone);\n      if (fallbackPhone) {\n        try {\n          // Try multiple endpoints to find the correct one\n          const endpoints = [`http://localhost:3000/api/auth/otp/latest?phone=${fallbackPhone}`, `http://localhost:3000/api/otp/latest?phone=${fallbackPhone}`, `/auth/otp/latest?phone=${fallbackPhone}`, `/otp/latest?phone=${fallbackPhone}`];\n          for (const endpoint of endpoints) {\n            try {\n              console.log('Trying endpoint:', endpoint);\n              const response = await fetch(endpoint);\n              console.log('Response status:', response.status);\n              if (response.ok) {\n                const data = await response.json();\n                console.log('API Response:', data);\n                if (data.success && data.otp) {\n                  console.log('Setting OTP:', data.otp);\n                  setDevOtp(data.otp);\n                  return; // Success, exit the loop\n                }\n              }\n            } catch (error) {\n              console.log('Endpoint failed:', endpoint, error);\n              continue; // Try next endpoint\n            }\n          }\n\n          // If all endpoints fail, try to extract OTP from console logs\n          console.log('All endpoints failed, trying alternative method');\n          // For development, we can try to get the OTP from localStorage or a mock\n          const mockOtp = '427521'; // Fallback for testing\n          console.log('Using fallback OTP:', mockOtp);\n          setDevOtp(mockOtp);\n        } catch (error) {\n          console.log('Could not fetch latest OTP:', error);\n          // Set a fallback OTP for testing\n          setDevOtp('427521');\n        }\n      } else {\n        console.log('No phone number available');\n      }\n    };\n    fetchDevOtp();\n  }, [fallbackPhone]);\n  useEffect(() => {\n    if (timeLeft > 0) {\n      const timer = setTimeout(() => setTimeLeft(timeLeft - 1), 1000);\n      return () => clearTimeout(timer);\n    } else {\n      setCanResend(true);\n    }\n  }, [timeLeft]);\n  const handleOtpChange = (index, value) => {\n    if (value.length > 1) return;\n    const newOtp = [...otp];\n    newOtp[index] = value;\n    setOtp(newOtp);\n\n    // Auto-focus next input\n    if (value && index < 5) {\n      var _otpInputs$current;\n      (_otpInputs$current = otpInputs.current[index + 1]) === null || _otpInputs$current === void 0 ? void 0 : _otpInputs$current.focus();\n    }\n  };\n  const handleKeyDown = (index, e) => {\n    if (e.key === 'Backspace' && !otp[index] && index > 0) {\n      var _otpInputs$current2;\n      (_otpInputs$current2 = otpInputs.current[index - 1]) === null || _otpInputs$current2 === void 0 ? void 0 : _otpInputs$current2.focus();\n    }\n  };\n  const handleVerifyOTP = async e => {\n    e.preventDefault();\n    const otpString = otp.join('');\n    if (otpString.length !== 6) {\n      alert('Please enter a valid 6-digit OTP');\n      return;\n    }\n    try {\n      setLoading(true);\n      const response = await authService.verifyOTP(phone, otpString);\n      if (response.success && response.token) {\n        // Token is already stored by authService\n\n        // Save phone number for DocumentUpload screen\n        localStorage.setItem('phoneNumber', phone);\n\n        // Check partner status to determine navigation\n        const status = response.partner.status;\n        const documentsUploaded = response.partner.documentsUploaded;\n        if (status === 'active' || status === 'approved') {\n          navigate('/dashboard');\n        } else if (status === 'pending' && documentsUploaded) {\n          // If pending but documents are already uploaded, go to status check page\n          navigate('/approval-pending');\n        } else {\n          // For pending/new partners without docs, go to document upload\n          navigate('/document-upload');\n        }\n      } else {\n        alert(response.message || 'OTP verification failed. Please try again.');\n      }\n    } catch (error) {\n      var _error$response, _error$response$data;\n      console.error('Error:', error);\n      alert(((_error$response = error.response) === null || _error$response === void 0 ? void 0 : (_error$response$data = _error$response.data) === null || _error$response$data === void 0 ? void 0 : _error$response$data.message) || 'Invalid OTP. Please try again.');\n    } finally {\n      setLoading(false);\n    }\n  };\n  const handleResendOTP = async () => {\n    try {\n      var _otpInputs$current$;\n      setLoading(true);\n      await authService.sendOTP(phone);\n      setTimeLeft(60);\n      setCanResend(false);\n      setOtp(['', '', '', '', '', '']);\n      (_otpInputs$current$ = otpInputs.current[0]) === null || _otpInputs$current$ === void 0 ? void 0 : _otpInputs$current$.focus();\n\n      // Fetch and update dev OTP after resend using same multi-endpoint approach\n      try {\n        const endpoints = [`http://localhost:3000/api/auth/otp/latest?phone=${phone}`, `http://localhost:3000/api/otp/latest?phone=${phone}`, `/auth/otp/latest?phone=${phone}`, `/otp/latest?phone=${phone}`];\n        for (const endpoint of endpoints) {\n          try {\n            const response = await fetch(endpoint);\n            if (response.ok) {\n              const data = await response.json();\n              if (data.success && data.otp) {\n                setDevOtp(data.otp);\n                setShowOtpDisplay(true);\n                return;\n              }\n            }\n          } catch (error) {\n            continue;\n          }\n        }\n\n        // Fallback\n        setDevOtp('427521');\n        setShowOtpDisplay(true);\n      } catch (error) {\n        console.log('Could not fetch latest OTP:', error);\n        setDevOtp('427521');\n        setShowOtpDisplay(true);\n      }\n      alert('OTP sent successfully');\n    } catch (error) {\n      console.error('Error:', error);\n      alert('Failed to resend OTP. Please try again.');\n    } finally {\n      setLoading(false);\n    }\n  };\n  const copyOtpToClipboard = () => {\n    if (devOtp) {\n      navigator.clipboard.writeText(devOtp).then(() => {\n        alert('OTP copied to clipboard!');\n      }).catch(() => {\n        alert('Failed to copy OTP. Please copy manually: ' + devOtp);\n      });\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4\",\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"bg-white rounded-2xl shadow-xl p-8 w-full max-w-md\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"text-center mb-8\",\n        children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n          className: \"text-2xl font-bold text-gray-900\",\n          children: \"Verify OTP\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 215,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"text-gray-600 mt-2\",\n          children: [\"Enter the 6-digit code sent to \", fallbackPhone]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 216,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 214,\n        columnNumber: 9\n      }, this), showOtpDisplay && devOtp && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"mb-6\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"bg-gradient-to-r from-blue-500 to-purple-600 rounded-2xl p-1 shadow-xl\",\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"bg-white rounded-2xl p-6\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"flex items-center justify-between mb-4\",\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"flex items-center space-x-3\",\n                children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"w-10 h-10 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center\",\n                  children: /*#__PURE__*/_jsxDEV(\"svg\", {\n                    className: \"w-6 h-6 text-white\",\n                    fill: \"none\",\n                    stroke: \"currentColor\",\n                    viewBox: \"0 0 24 24\",\n                    children: /*#__PURE__*/_jsxDEV(\"path\", {\n                      strokeLinecap: \"round\",\n                      strokeLinejoin: \"round\",\n                      strokeWidth: \"2\",\n                      d: \"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z\"\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 228,\n                      columnNumber: 25\n                    }, this)\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 227,\n                    columnNumber: 23\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 226,\n                  columnNumber: 21\n                }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                  children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n                    className: \"text-lg font-bold text-gray-900\",\n                    children: \"Your OTP Code\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 232,\n                    columnNumber: 23\n                  }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n                    className: \"text-sm text-gray-500\",\n                    children: \"Ready to use\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 233,\n                    columnNumber: 23\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 231,\n                  columnNumber: 21\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 225,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                onClick: () => setShowOtpDisplay(false),\n                className: \"text-gray-400 hover:text-gray-600 transition-colors\",\n                children: /*#__PURE__*/_jsxDEV(\"svg\", {\n                  className: \"w-5 h-5\",\n                  fill: \"none\",\n                  stroke: \"currentColor\",\n                  viewBox: \"0 0 24 24\",\n                  children: /*#__PURE__*/_jsxDEV(\"path\", {\n                    strokeLinecap: \"round\",\n                    strokeLinejoin: \"round\",\n                    strokeWidth: \"2\",\n                    d: \"M6 18L18 6M6 6l12 12\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 241,\n                    columnNumber: 23\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 240,\n                  columnNumber: 21\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 236,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 224,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"bg-gradient-to-r from-blue-50 to-purple-50 rounded-xl p-4 mb-4\",\n              children: /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"text-center\",\n                children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"text-4xl font-bold text-gray-900 tracking-widest mb-2\",\n                  children: devOtp.split('').map((digit, index) => /*#__PURE__*/_jsxDEV(\"span\", {\n                    className: \"inline-block mx-1\",\n                    children: digit\n                  }, index, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 250,\n                    columnNumber: 25\n                  }, this))\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 248,\n                  columnNumber: 21\n                }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"text-sm text-gray-500\",\n                  children: [\"Valid for \", timeLeft, \" seconds\"]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 253,\n                  columnNumber: 21\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 247,\n                columnNumber: 19\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 246,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"flex space-x-3\",\n              children: [/*#__PURE__*/_jsxDEV(\"button\", {\n                onClick: copyOtpToClipboard,\n                className: \"flex-1 bg-gradient-to-r from-blue-500 to-blue-600 text-white py-3 px-4 rounded-xl font-medium hover:from-blue-600 hover:to-blue-700 transition-all duration-200 flex items-center justify-center space-x-2 shadow-lg\",\n                children: [/*#__PURE__*/_jsxDEV(\"svg\", {\n                  className: \"w-5 h-5\",\n                  fill: \"none\",\n                  stroke: \"currentColor\",\n                  viewBox: \"0 0 24 24\",\n                  children: /*#__PURE__*/_jsxDEV(\"path\", {\n                    strokeLinecap: \"round\",\n                    strokeLinejoin: \"round\",\n                    strokeWidth: \"2\",\n                    d: \"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 265,\n                    columnNumber: 23\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 264,\n                  columnNumber: 21\n                }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                  children: \"Copy OTP\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 267,\n                  columnNumber: 21\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 260,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                onClick: () => {\n                  const otpArray = devOtp.split('');\n                  setOtp(otpArray);\n                  setTimeout(() => {\n                    var _otpInputs$current3;\n                    (_otpInputs$current3 = otpInputs.current[otpArray.length - 1]) === null || _otpInputs$current3 === void 0 ? void 0 : _otpInputs$current3.focus();\n                  }, 100);\n                },\n                className: \"flex-1 bg-gradient-to-r from-green-500 to-green-600 text-white py-3 px-4 rounded-xl font-medium hover:from-green-600 hover:to-green-700 transition-all duration-200 flex items-center justify-center space-x-2 shadow-lg\",\n                children: [/*#__PURE__*/_jsxDEV(\"svg\", {\n                  className: \"w-5 h-5\",\n                  fill: \"none\",\n                  stroke: \"currentColor\",\n                  viewBox: \"0 0 24 24\",\n                  children: /*#__PURE__*/_jsxDEV(\"path\", {\n                    strokeLinecap: \"round\",\n                    strokeLinejoin: \"round\",\n                    strokeWidth: \"2\",\n                    d: \"M5 13l4 4L19 7\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 280,\n                    columnNumber: 23\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 279,\n                  columnNumber: 21\n                }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                  children: \"Auto-fill\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 282,\n                  columnNumber: 21\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 269,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 259,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 223,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 222,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 221,\n        columnNumber: 11\n      }, this), !showOtpDisplay && devOtp && /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: () => setShowOtpDisplay(true),\n        className: \"w-full mb-6 p-4 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-xl hover:from-blue-600 hover:to-purple-700 transition-all duration-200 flex items-center justify-center space-x-3 shadow-lg\",\n        children: [/*#__PURE__*/_jsxDEV(\"svg\", {\n          className: \"w-6 h-6\",\n          fill: \"none\",\n          stroke: \"currentColor\",\n          viewBox: \"0 0 24 24\",\n          children: /*#__PURE__*/_jsxDEV(\"path\", {\n            strokeLinecap: \"round\",\n            strokeLinejoin: \"round\",\n            strokeWidth: \"2\",\n            d: \"M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 297,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 296,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n          className: \"font-medium\",\n          children: \"Show OTP Code\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 299,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 292,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"form\", {\n        onSubmit: handleVerifyOTP,\n        className: \"space-y-6\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"flex justify-center space-x-2\",\n          children: otp.map((digit, index) => /*#__PURE__*/_jsxDEV(\"input\", {\n            ref: el => otpInputs.current[index] = el,\n            type: \"text\",\n            value: digit,\n            onChange: e => handleOtpChange(index, e.target.value),\n            onKeyDown: e => handleKeyDown(index, e),\n            className: \"w-12 h-12 text-center text-lg font-semibold border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none\",\n            maxLength: 1,\n            required: true\n          }, index, false, {\n            fileName: _jsxFileName,\n            lineNumber: 306,\n            columnNumber: 15\n          }, this))\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 304,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          type: \"submit\",\n          disabled: loading || otp.join('').length !== 6,\n          className: \"w-full bg-blue-600 text-white py-3 px-4 rounded-lg font-medium hover:bg-blue-700 transition duration-200 disabled:opacity-50 disabled:cursor-not-allowed\",\n          children: loading ? 'Verifying...' : 'Verify OTP'\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 320,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"text-center\",\n          children: /*#__PURE__*/_jsxDEV(\"button\", {\n            type: \"button\",\n            onClick: handleResendOTP,\n            disabled: !canResend || loading,\n            className: \"text-blue-600 hover:text-blue-700 text-sm disabled:opacity-50 disabled:cursor-not-allowed\",\n            children: canResend ? 'Resend OTP' : `Resend OTP in ${timeLeft}s`\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 329,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 328,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 303,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"mt-6 text-center\",\n        children: /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: () => navigate('/'),\n          className: \"text-gray-600 hover:text-gray-700 text-sm\",\n          children: \"\\u2190 Back to Mobile Number\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 341,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 340,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 213,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 212,\n    columnNumber: 5\n  }, this);\n};\n_s(OTPVerification, \"k72UaMxtb3YEx8ujprjt+Fu8hMY=\", false, function () {\n  return [useNavigate, useLocation];\n});\n_c = OTPVerification;\nexport default OTPVerification;\nvar _c;\n$RefreshReg$(_c, \"OTPVerification\");","map":{"version":3,"names":["React","useState","useRef","useEffect","useNavigate","useLocation","authService","api","jsxDEV","_jsxDEV","OTPVerification","_s","otp","setOtp","loading","setLoading","timeLeft","setTimeLeft","canResend","setCanResend","showOtpDisplay","setShowOtpDisplay","devOtp","setDevOtp","navigate","location","phone","isNewPartner","isApproved","state","fallbackPhone","localStorage","getItem","otpInputs","fetchDevOtp","console","log","endpoints","endpoint","response","fetch","status","ok","data","json","success","error","mockOtp","timer","setTimeout","clearTimeout","handleOtpChange","index","value","length","newOtp","_otpInputs$current","current","focus","handleKeyDown","e","key","_otpInputs$current2","handleVerifyOTP","preventDefault","otpString","join","alert","verifyOTP","token","setItem","partner","documentsUploaded","message","_error$response","_error$response$data","handleResendOTP","_otpInputs$current$","sendOTP","copyOtpToClipboard","navigator","clipboard","writeText","then","catch","className","children","fileName","_jsxFileName","lineNumber","columnNumber","fill","stroke","viewBox","strokeLinecap","strokeLinejoin","strokeWidth","d","onClick","split","map","digit","otpArray","_otpInputs$current3","onSubmit","ref","el","type","onChange","target","onKeyDown","maxLength","required","disabled","_c","$RefreshReg$"],"sources":["C:/Users/karthip/Downloads/super_app-main-5 (1)/super_app-main-5/super_app-main/urban-partner-app/src/screens/auth/OTPVerification.jsx"],"sourcesContent":["import React, { useState, useRef, useEffect } from 'react';\r\nimport { useNavigate, useLocation } from 'react-router-dom';\r\nimport authService from '../../services/authService';\r\nimport api from '../../services/api';\r\n\r\nconst OTPVerification = () => {\r\n  const [otp, setOtp] = useState(['', '', '', '', '', '']);\r\n  const [loading, setLoading] = useState(false);\r\n  const [timeLeft, setTimeLeft] = useState(60);\r\n  const [canResend, setCanResend] = useState(false);\r\n  const [showOtpDisplay, setShowOtpDisplay] = useState(true);\r\n  const [devOtp, setDevOtp] = useState('');\r\n  const navigate = useNavigate();\r\n  const location = useLocation();\r\n  \r\n  const { phone, isNewPartner, isApproved } = location.state || {};\r\n  \r\n  // Fallback: try to get phone from localStorage if location.state is null\r\n  const fallbackPhone = phone || localStorage.getItem('pendingPhone') || '+918610097038';\r\n\r\n  const otpInputs = useRef([]);\r\n\r\n  // Fetch latest OTP for dev display\r\n  useEffect(() => {\r\n    const fetchDevOtp = async () => {\r\n      console.log('Fetching OTP for phone:', fallbackPhone);\r\n      if (fallbackPhone) {\r\n        try {\r\n          // Try multiple endpoints to find the correct one\r\n          const endpoints = [\r\n            `http://localhost:3000/api/auth/otp/latest?phone=${fallbackPhone}`,\r\n            `http://localhost:3000/api/otp/latest?phone=${fallbackPhone}`,\r\n            `/auth/otp/latest?phone=${fallbackPhone}`,\r\n            `/otp/latest?phone=${fallbackPhone}`\r\n          ];\r\n          \r\n          for (const endpoint of endpoints) {\r\n            try {\r\n              console.log('Trying endpoint:', endpoint);\r\n              const response = await fetch(endpoint);\r\n              console.log('Response status:', response.status);\r\n              \r\n              if (response.ok) {\r\n                const data = await response.json();\r\n                console.log('API Response:', data);\r\n                if (data.success && data.otp) {\r\n                  console.log('Setting OTP:', data.otp);\r\n                  setDevOtp(data.otp);\r\n                  return; // Success, exit the loop\r\n                }\r\n              }\r\n            } catch (error) {\r\n              console.log('Endpoint failed:', endpoint, error);\r\n              continue; // Try next endpoint\r\n            }\r\n          }\r\n          \r\n          // If all endpoints fail, try to extract OTP from console logs\r\n          console.log('All endpoints failed, trying alternative method');\r\n          // For development, we can try to get the OTP from localStorage or a mock\r\n          const mockOtp = '427521'; // Fallback for testing\r\n          console.log('Using fallback OTP:', mockOtp);\r\n          setDevOtp(mockOtp);\r\n          \r\n        } catch (error) {\r\n          console.log('Could not fetch latest OTP:', error);\r\n          // Set a fallback OTP for testing\r\n          setDevOtp('427521');\r\n        }\r\n      } else {\r\n        console.log('No phone number available');\r\n      }\r\n    };\r\n    fetchDevOtp();\r\n  }, [fallbackPhone]);\r\n\r\n  useEffect(() => {\r\n    if (timeLeft > 0) {\r\n      const timer = setTimeout(() => setTimeLeft(timeLeft - 1), 1000);\r\n      return () => clearTimeout(timer);\r\n    } else {\r\n      setCanResend(true);\r\n    }\r\n  }, [timeLeft]);\r\n\r\n  const handleOtpChange = (index, value) => {\r\n    if (value.length > 1) return;\r\n\r\n    const newOtp = [...otp];\r\n    newOtp[index] = value;\r\n    setOtp(newOtp);\r\n\r\n    // Auto-focus next input\r\n    if (value && index < 5) {\r\n      otpInputs.current[index + 1]?.focus();\r\n    }\r\n  };\r\n\r\n  const handleKeyDown = (index, e) => {\r\n    if (e.key === 'Backspace' && !otp[index] && index > 0) {\r\n      otpInputs.current[index - 1]?.focus();\r\n    }\r\n  };\r\n\r\n  const handleVerifyOTP = async (e) => {\r\n    e.preventDefault();\r\n    const otpString = otp.join('');\r\n\r\n    if (otpString.length !== 6) {\r\n      alert('Please enter a valid 6-digit OTP');\r\n      return;\r\n    }\r\n\r\n    try {\r\n      setLoading(true);\r\n      const response = await authService.verifyOTP(phone, otpString);\r\n\r\n      if (response.success && response.token) {\r\n        // Token is already stored by authService\r\n\r\n        // Save phone number for DocumentUpload screen\r\n        localStorage.setItem('phoneNumber', phone);\r\n\r\n        // Check partner status to determine navigation\r\n        const status = response.partner.status;\r\n        const documentsUploaded = response.partner.documentsUploaded;\r\n\r\n        if (status === 'active' || status === 'approved') {\r\n          navigate('/dashboard');\r\n        } else if (status === 'pending' && documentsUploaded) {\r\n          // If pending but documents are already uploaded, go to status check page\r\n          navigate('/approval-pending');\r\n        } else {\r\n          // For pending/new partners without docs, go to document upload\r\n          navigate('/document-upload');\r\n        }\r\n      } else {\r\n        alert(response.message || 'OTP verification failed. Please try again.');\r\n      }\r\n    } catch (error) {\r\n      console.error('Error:', error);\r\n      alert(error.response?.data?.message || 'Invalid OTP. Please try again.');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleResendOTP = async () => {\r\n    try {\r\n      setLoading(true);\r\n      await authService.sendOTP(phone);\r\n      setTimeLeft(60);\r\n      setCanResend(false);\r\n      setOtp(['', '', '', '', '', '']);\r\n      otpInputs.current[0]?.focus();\r\n      \r\n      // Fetch and update dev OTP after resend using same multi-endpoint approach\r\n      try {\r\n        const endpoints = [\r\n          `http://localhost:3000/api/auth/otp/latest?phone=${phone}`,\r\n          `http://localhost:3000/api/otp/latest?phone=${phone}`,\r\n          `/auth/otp/latest?phone=${phone}`,\r\n          `/otp/latest?phone=${phone}`\r\n        ];\r\n        \r\n        for (const endpoint of endpoints) {\r\n          try {\r\n            const response = await fetch(endpoint);\r\n            if (response.ok) {\r\n              const data = await response.json();\r\n              if (data.success && data.otp) {\r\n                setDevOtp(data.otp);\r\n                setShowOtpDisplay(true);\r\n                return;\r\n              }\r\n            }\r\n          } catch (error) {\r\n            continue;\r\n          }\r\n        }\r\n        \r\n        // Fallback\r\n        setDevOtp('427521');\r\n        setShowOtpDisplay(true);\r\n        \r\n      } catch (error) {\r\n        console.log('Could not fetch latest OTP:', error);\r\n        setDevOtp('427521');\r\n        setShowOtpDisplay(true);\r\n      }\r\n      \r\n      alert('OTP sent successfully');\r\n    } catch (error) {\r\n      console.error('Error:', error);\r\n      alert('Failed to resend OTP. Please try again.');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const copyOtpToClipboard = () => {\r\n    if (devOtp) {\r\n      navigator.clipboard.writeText(devOtp).then(() => {\r\n        alert('OTP copied to clipboard!');\r\n      }).catch(() => {\r\n        alert('Failed to copy OTP. Please copy manually: ' + devOtp);\r\n      });\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4\">\r\n      <div className=\"bg-white rounded-2xl shadow-xl p-8 w-full max-w-md\">\r\n        <div className=\"text-center mb-8\">\r\n          <h1 className=\"text-2xl font-bold text-gray-900\">Verify OTP</h1>\r\n          <p className=\"text-gray-600 mt-2\">Enter the 6-digit code sent to {fallbackPhone}</p>\r\n        </div>\r\n\r\n        {/* Modern OTP Display */}\r\n        {showOtpDisplay && devOtp && (\r\n          <div className=\"mb-6\">\r\n            <div className=\"bg-gradient-to-r from-blue-500 to-purple-600 rounded-2xl p-1 shadow-xl\">\r\n              <div className=\"bg-white rounded-2xl p-6\">\r\n                <div className=\"flex items-center justify-between mb-4\">\r\n                  <div className=\"flex items-center space-x-3\">\r\n                    <div className=\"w-10 h-10 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center\">\r\n                      <svg className=\"w-6 h-6 text-white\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth=\"2\" d=\"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z\"></path>\r\n                      </svg>\r\n                    </div>\r\n                    <div>\r\n                      <h3 className=\"text-lg font-bold text-gray-900\">Your OTP Code</h3>\r\n                      <p className=\"text-sm text-gray-500\">Ready to use</p>\r\n                    </div>\r\n                  </div>\r\n                  <button\r\n                    onClick={() => setShowOtpDisplay(false)}\r\n                    className=\"text-gray-400 hover:text-gray-600 transition-colors\"\r\n                  >\r\n                    <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth=\"2\" d=\"M6 18L18 6M6 6l12 12\"></path>\r\n                    </svg>\r\n                  </button>\r\n                </div>\r\n                \r\n                <div className=\"bg-gradient-to-r from-blue-50 to-purple-50 rounded-xl p-4 mb-4\">\r\n                  <div className=\"text-center\">\r\n                    <div className=\"text-4xl font-bold text-gray-900 tracking-widest mb-2\">\r\n                      {devOtp.split('').map((digit, index) => (\r\n                        <span key={index} className=\"inline-block mx-1\">{digit}</span>\r\n                      ))}\r\n                    </div>\r\n                    <div className=\"text-sm text-gray-500\">\r\n                      Valid for {timeLeft} seconds\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n                \r\n                <div className=\"flex space-x-3\">\r\n                  <button\r\n                    onClick={copyOtpToClipboard}\r\n                    className=\"flex-1 bg-gradient-to-r from-blue-500 to-blue-600 text-white py-3 px-4 rounded-xl font-medium hover:from-blue-600 hover:to-blue-700 transition-all duration-200 flex items-center justify-center space-x-2 shadow-lg\"\r\n                  >\r\n                    <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth=\"2\" d=\"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z\"></path>\r\n                    </svg>\r\n                    <span>Copy OTP</span>\r\n                  </button>\r\n                  <button\r\n                    onClick={() => {\r\n                      const otpArray = devOtp.split('');\r\n                      setOtp(otpArray);\r\n                      setTimeout(() => {\r\n                        otpInputs.current[otpArray.length - 1]?.focus();\r\n                      }, 100);\r\n                    }}\r\n                    className=\"flex-1 bg-gradient-to-r from-green-500 to-green-600 text-white py-3 px-4 rounded-xl font-medium hover:from-green-600 hover:to-green-700 transition-all duration-200 flex items-center justify-center space-x-2 shadow-lg\"\r\n                  >\r\n                    <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth=\"2\" d=\"M5 13l4 4L19 7\"></path>\r\n                    </svg>\r\n                    <span>Auto-fill</span>\r\n                  </button>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        {/* Show OTP button (when hidden) */}\r\n        {!showOtpDisplay && devOtp && (\r\n          <button\r\n            onClick={() => setShowOtpDisplay(true)}\r\n            className=\"w-full mb-6 p-4 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-xl hover:from-blue-600 hover:to-purple-700 transition-all duration-200 flex items-center justify-center space-x-3 shadow-lg\"\r\n          >\r\n            <svg className=\"w-6 h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth=\"2\" d=\"M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z\"></path>\r\n            </svg>\r\n            <span className=\"font-medium\">Show OTP Code</span>\r\n          </button>\r\n        )}\r\n\r\n        <form onSubmit={handleVerifyOTP} className=\"space-y-6\">\r\n          <div className=\"flex justify-center space-x-2\">\r\n            {otp.map((digit, index) => (\r\n              <input\r\n                key={index}\r\n                ref={(el) => (otpInputs.current[index] = el)}\r\n                type=\"text\"\r\n                value={digit}\r\n                onChange={(e) => handleOtpChange(index, e.target.value)}\r\n                onKeyDown={(e) => handleKeyDown(index, e)}\r\n                className=\"w-12 h-12 text-center text-lg font-semibold border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none\"\r\n                maxLength={1}\r\n                required\r\n              />\r\n            ))}\r\n          </div>\r\n\r\n          <button\r\n            type=\"submit\"\r\n            disabled={loading || otp.join('').length !== 6}\r\n            className=\"w-full bg-blue-600 text-white py-3 px-4 rounded-lg font-medium hover:bg-blue-700 transition duration-200 disabled:opacity-50 disabled:cursor-not-allowed\"\r\n          >\r\n            {loading ? 'Verifying...' : 'Verify OTP'}\r\n          </button>\r\n\r\n          <div className=\"text-center\">\r\n            <button\r\n              type=\"button\"\r\n              onClick={handleResendOTP}\r\n              disabled={!canResend || loading}\r\n              className=\"text-blue-600 hover:text-blue-700 text-sm disabled:opacity-50 disabled:cursor-not-allowed\"\r\n            >\r\n              {canResend ? 'Resend OTP' : `Resend OTP in ${timeLeft}s`}\r\n            </button>\r\n          </div>\r\n        </form>\r\n\r\n        <div className=\"mt-6 text-center\">\r\n          <button\r\n            onClick={() => navigate('/')}\r\n            className=\"text-gray-600 hover:text-gray-700 text-sm\"\r\n          >\r\n            ‚Üê Back to Mobile Number\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default OTPVerification;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}