{"ast":null,"code":"import api from'./api';class PaymentService{constructor(){this.razorpay=null;this.initializeRazorpay();}initializeRazorpay(){if(typeof window!=='undefined'&&!window.Razorpay){const script=document.createElement('script');script.src='https://checkout.razorpay.com/v1/checkout.js';script.async=true;script.onload=()=>console.log('✅ Razorpay SDK loaded');script.onerror=()=>console.error('❌ Failed to load Razorpay SDK');document.head.appendChild(script);}}async getRazorpayKey(){try{const response=await api.get('/payments/razorpay-key');if(response.data.success){return response.data.data.key_id;}return null;}catch(error){console.error('Error getting Razorpay key:',error);return null;}}async createRazorpayOrder(paymentData){try{const response=await api.post('/payments/create-order',paymentData);return response.data;}catch(error){console.error('Error creating Razorpay order:',error);throw error;}}async verifyPayment(verificationData){try{const response=await api.post('/payments/verify',verificationData);return response.data;}catch(error){console.error('Error verifying payment:',error);throw error;}}async processPayment(orderData){let options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};try{const razorpayKey=await this.getRazorpayKey();if(!razorpayKey){throw new Error('Payment service is currently unavailable');}const orderResponse=await this.createRazorpayOrder({amount:orderData.amount,currency:orderData.currency||'INR',order_id:orderData.order_id,order_model:'ServiceBooking',description:orderData.description||'Urban Service Payment',email:orderData.email||'customer@example.com',contact:orderData.contact||'9876543210'});if(!orderResponse.success){throw new Error('Failed to create payment order');}const{razorpayOrder,payment}=orderResponse.data;const paymentOptions={key:razorpayKey,amount:razorpayOrder.amount,currency:razorpayOrder.currency,name:options.businessName||'Urban Partner',description:orderData.description||'Payment for service',order_id:razorpayOrder.id,handler:async response=>{try{const verificationData={razorpay_payment_id:response.razorpay_payment_id,razorpay_order_id:response.razorpay_order_id,razorpay_signature:response.razorpay_signature,payment_id:payment._id};const verificationResponse=await this.verifyPayment(verificationData);if(verificationResponse.success){if(options.onSuccess)options.onSuccess(verificationResponse.data);}else{throw new Error('Payment verification failed');}}catch(error){if(options.onError)options.onError(error);}},prefill:{name:orderData.customerName||'',email:orderData.email||'',contact:orderData.contact||''},theme:{color:options.themeColor||'#3b82f6'},modal:{ondismiss:()=>{if(options.onCancel)options.onCancel();}}};const rzp=new window.Razorpay(paymentOptions);rzp.open();}catch(error){console.error('Payment processing error:',error);if(options.onError)options.onError(error);throw error;}}}export default new PaymentService();","map":{"version":3,"names":["api","PaymentService","constructor","razorpay","initializeRazorpay","window","Razorpay","script","document","createElement","src","async","onload","console","log","onerror","error","head","appendChild","getRazorpayKey","response","get","data","success","key_id","createRazorpayOrder","paymentData","post","verifyPayment","verificationData","processPayment","orderData","options","arguments","length","undefined","razorpayKey","Error","orderResponse","amount","currency","order_id","order_model","description","email","contact","razorpayOrder","payment","paymentOptions","key","name","businessName","id","handler","razorpay_payment_id","razorpay_order_id","razorpay_signature","payment_id","_id","verificationResponse","onSuccess","onError","prefill","customerName","theme","color","themeColor","modal","ondismiss","onCancel","rzp","open"],"sources":["C:/Users/THILOCIGAN/Documents/super_app-main_2/super_app-main/urban-partner-app/src/services/paymentService.js"],"sourcesContent":["import api from './api';\r\n\r\nclass PaymentService {\r\n    constructor() {\r\n        this.razorpay = null;\r\n        this.initializeRazorpay();\r\n    }\r\n\r\n    initializeRazorpay() {\r\n        if (typeof window !== 'undefined' && !window.Razorpay) {\r\n            const script = document.createElement('script');\r\n            script.src = 'https://checkout.razorpay.com/v1/checkout.js';\r\n            script.async = true;\r\n            script.onload = () => console.log('✅ Razorpay SDK loaded');\r\n            script.onerror = () => console.error('❌ Failed to load Razorpay SDK');\r\n            document.head.appendChild(script);\r\n        }\r\n    }\r\n\r\n    async getRazorpayKey() {\r\n        try {\r\n            const response = await api.get('/payments/razorpay-key');\r\n            if (response.data.success) {\r\n                return response.data.data.key_id;\r\n            }\r\n            return null;\r\n        } catch (error) {\r\n            console.error('Error getting Razorpay key:', error);\r\n            return null;\r\n        }\r\n    }\r\n\r\n    async createRazorpayOrder(paymentData) {\r\n        try {\r\n            const response = await api.post('/payments/create-order', paymentData);\r\n            return response.data;\r\n        } catch (error) {\r\n            console.error('Error creating Razorpay order:', error);\r\n            throw error;\r\n        }\r\n    }\r\n\r\n    async verifyPayment(verificationData) {\r\n        try {\r\n            const response = await api.post('/payments/verify', verificationData);\r\n            return response.data;\r\n        } catch (error) {\r\n            console.error('Error verifying payment:', error);\r\n            throw error;\r\n        }\r\n    }\r\n\r\n    async processPayment(orderData, options = {}) {\r\n        try {\r\n            const razorpayKey = await this.getRazorpayKey();\r\n            if (!razorpayKey) {\r\n                throw new Error('Payment service is currently unavailable');\r\n            }\r\n\r\n            const orderResponse = await this.createRazorpayOrder({\r\n                amount: orderData.amount,\r\n                currency: orderData.currency || 'INR',\r\n                order_id: orderData.order_id,\r\n                order_model: 'ServiceBooking',\r\n                description: orderData.description || 'Urban Service Payment',\r\n                email: orderData.email || 'customer@example.com',\r\n                contact: orderData.contact || '9876543210'\r\n            });\r\n\r\n            if (!orderResponse.success) {\r\n                throw new Error('Failed to create payment order');\r\n            }\r\n\r\n            const { razorpayOrder, payment } = orderResponse.data;\r\n\r\n            const paymentOptions = {\r\n                key: razorpayKey,\r\n                amount: razorpayOrder.amount,\r\n                currency: razorpayOrder.currency,\r\n                name: options.businessName || 'Urban Partner',\r\n                description: orderData.description || 'Payment for service',\r\n                order_id: razorpayOrder.id,\r\n                handler: async (response) => {\r\n                    try {\r\n                        const verificationData = {\r\n                            razorpay_payment_id: response.razorpay_payment_id,\r\n                            razorpay_order_id: response.razorpay_order_id,\r\n                            razorpay_signature: response.razorpay_signature,\r\n                            payment_id: payment._id\r\n                        };\r\n\r\n                        const verificationResponse = await this.verifyPayment(verificationData);\r\n                        if (verificationResponse.success) {\r\n                            if (options.onSuccess) options.onSuccess(verificationResponse.data);\r\n                        } else {\r\n                            throw new Error('Payment verification failed');\r\n                        }\r\n                    } catch (error) {\r\n                        if (options.onError) options.onError(error);\r\n                    }\r\n                },\r\n                prefill: {\r\n                    name: orderData.customerName || '',\r\n                    email: orderData.email || '',\r\n                    contact: orderData.contact || ''\r\n                },\r\n                theme: {\r\n                    color: options.themeColor || '#3b82f6'\r\n                },\r\n                modal: {\r\n                    ondismiss: () => {\r\n                        if (options.onCancel) options.onCancel();\r\n                    }\r\n                }\r\n            };\r\n\r\n            const rzp = new window.Razorpay(paymentOptions);\r\n            rzp.open();\r\n\r\n        } catch (error) {\r\n            console.error('Payment processing error:', error);\r\n            if (options.onError) options.onError(error);\r\n            throw error;\r\n        }\r\n    }\r\n}\r\n\r\nexport default new PaymentService();\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}